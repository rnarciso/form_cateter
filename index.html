<div class="header">
    <h1>INSERÇÃO DE CATETER VENOSO CENTRAL</h1>
</div>
<form id="cvcForm">
    <div class="catheter-info">
        <div class="form-row">
            <div class="form-group"><label for="catheterType">Tipo de Cateter:</label> <select id="catheterType" required="">
                    <option value="">Selecione o tipo</option>
                    <option value="cvc">CVC (Cateter Venoso Central)</option>
                    <option value="picc">PICC (Cateter Central de Inserção Periférica)</option>
                    <option value="hemodialitico">Cateter de Hemodiálise</option>
                    <option value="port">Port-a-Cath (Porto de Acesso Venoso)</option>
                    <option value="hickman">Hickman/Broviac</option>
                </select></div>
            <div class="form-group"><label for="lumensNumber">Número de Lúmens:</label> <input type="number" id="lumensNumber" min="1" max="7" required=""></div>
        </div>
    </div>
    <div class="form-row">
        <div class="form-group"><label for="startTime">Início do procedimento:</label> <input type="datetime-local" id="startTime" required=""></div>
        <div class="form-group"><label for="endTime">Término do procedimento:</label> <input type="datetime-local" id="endTime" required=""></div>
    </div>
    <div class="puncture-site">
        <div class="site-selections">
            <p><label>Sítio de Punção:</label></p>
            <div class="radio-group"><input type="radio" name="punctureSite" value="jugular" id="jugular" required=""> <label for="jugular">Veia Jugular</label> <input type="radio" name="punctureSite" value="subclavia" id="subclavia"> <label for="subclavia">Veia Subclávia</label> <input type="radio" name="punctureSite" value="femoral" id="femoral"> <label for="femoral">Veia Femoral</label></div>
        </div>
        <div class="laterality-section">
            <p><label>Lateralidade:</label></p>
            <div class="radio-group"><input type="radio" name="laterality" value="direita" id="rightSide" required=""> <label for="rightSide">Direita</label> <input type="radio" name="laterality" value="esquerda" id="leftSide"> <label for="leftSide">Esquerda</label></div>
        </div>
    </div>
    <div class="form-group" style="display:none;" id="xrayCheckSection">
        <p><label>Solicitada radiografia de tórax após término do procedimento?</label></p>
        <div class="radio-group"><label><input type="radio" name="xrayCheck" value="nao"> Não <input type="radio" name="xrayCheck" value="sim"> Sim&nbsp;</label></div>
    </div>
    <div class="femoral-justification" id="femoralJustificationSection"><label for="femoralJustification">Justificativa para Acesso Femoral (OBRIGATÓRIO):</label> <textarea id="femoralJustification" rows="6" placeholder="Descreva detalhadamente a justificativa para utilização do acesso femoral. Inclua:
- Tentativas prévias em outros sítios
- Contraindicações específicas para outros acessos
- Condições anatômicas especiais
- Urgência/emergência que justifique
- Avaliação do risco de infecção
- Plano para mudança do acesso assim que possível"></textarea></div>
    <div class="form-group">
        <p><label>Condição: &nbsp; &nbsp;&nbsp;<input type="radio" name="condition" value="eletiva" required="">Eletiva &nbsp;<input type="radio" name="condition" value="urgencia">Urgência</label></p>
        <div class="radio-group"><label>&nbsp;&nbsp;</label></div>
    </div>
    <div class="form-group">
        <p><label>Utilização de Ultrassom: <input type="radio" name="ultrasound" value="nao" required=""> Não <input type="radio" name="ultrasound" value="sim"> Sim&nbsp;</label></p>
        <p>&nbsp;</p>
        <p><label>Número de tentativas de punção: <input type="number" id="attempts" min="1" max="7" required=""></label></p>
    </div>
    <div class="form-group">
        <p><label>Sucesso na inserção do CVC: <input type="radio" name="success" value="nao" required=""> Não <input type="radio" name="success" value="sim"> Sim&nbsp;</label></p>
    </div>
    <figure class="table">
        <table class="complications-table">
            <thead>
                <tr>
                    <th>Complicações associadas à inserção do CVC</th>
                    <th>Não</th>
                    <th>Sim</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Punção arterial</td>
                    <td><input type="radio" name="puncture" value="nao" required=""></td>
                    <td><input type="radio" name="puncture" value="sim"></td>
                </tr>
                <tr>
                    <td>Pneumotórax</td>
                    <td><input type="radio" name="pneumothorax" value="nao" required=""></td>
                    <td><input type="radio" name="pneumothorax" value="sim"></td>
                </tr>
                <tr>
                    <td>Hemotórax</td>
                    <td><input type="radio" name="hemothorax" value="nao" required=""></td>
                    <td><input type="radio" name="hemothorax" value="sim"></td>
                </tr>
                <tr>
                    <td>Sangramento</td>
                    <td><input type="radio" name="bleeding" value="nao" required=""></td>
                    <td><input type="radio" name="bleeding" value="sim"></td>
                </tr>
                <tr>
                    <td>Arritmia maligna</td>
                    <td><input type="radio" name="arrhythmia" value="nao" required=""></td>
                    <td><input type="radio" name="arrhythmia" value="sim"></td>
                </tr>
            </tbody>
        </table>
    </figure>
    <div class="grau-info" style="display:none;" id="grauSangramentoDiv">
        <h3>Grau do Sangramento:</h3>
        <div class="radio-group"><label><input type="radio" name="grauSangramento" value="grau1"> Grau 1</label> <label><input type="radio" name="grauSangramento" value="grau2"> Grau 2</label> <label><input type="radio" name="grauSangramento" value="grau3"> Grau 3</label> <label><input type="radio" name="grauSangramento" value="grau4"> Grau 4</label></div>
        <ul>
            <li><strong>Grau 1:</strong> Sangramento pequeno que não necessitou de intervenção</li>
            <li><strong>Grau 2:</strong> Sangramento que necessitou de compressão externa</li>
            <li><strong>Grau 3:</strong> Sangramento que demandou intervenção invasiva ou transfusão de sangue</li>
            <li><strong>Grau 4:</strong> Sangramentos com risco de vida</li>
        </ul>
    </div>
    <div class="grau-info" style="display:none;" id="grauArritmiaDiv">
        <h3>Grau da Arritmia:</h3>
        <div class="radio-group"><label><input type="radio" name="grauArritmia" value="grau1"> Grau 1</label> <label><input type="radio" name="grauArritmia" value="grau2"> Grau 2</label> <label><input type="radio" name="grauArritmia" value="grau3"> Grau 3</label></div>
        <ul>
            <li><strong>Grau 1:</strong> Assintomática ou sintomático leve. Não necessitou de intervenção ou necessitou intervenção mínima, não invasiva.</li>
            <li><strong>Grau 2:</strong> Sintomático, demandou intervenção médica urgente como cardioversão elétrica ou química, desfibrilação, antiarrítmicos.</li>
            <li><strong>Grau 3:</strong> Arritmia ameaçadora à vida.</li>
        </ul>
    </div>
    <p><button style="background-color:#007bff;border-radius:4px;border-style:none;color:white;cursor:pointer;padding:10px 20px;" type="submit">
            Salvar Registro
        </button></p>
</form>
<script>
// Função para mostrar/esconder justificativa femoral e verificação de raio X
document.querySelectorAll('input[name="punctureSite"]')
    .forEach(radio => {
        radio.addEventListener('change', function () {
            const femoralJustification = document.getElementById('femoralJustificationSection');
            const xrayCheck = document.getElementById('xrayCheckSection');
            
            // Gerencia seção de justificativa femoral
            if(this.value === 'femoral') {
                femoralJustification.style.display = 'block';
                document.getElementById('femoralJustification')
                    .required = true;
                xrayCheck.style.display = 'none';
                document.querySelectorAll('input[name="xrayCheck"]')
                    .forEach(radio => radio.required = false);
            } else {
                femoralJustification.style.display = 'none';
                document.getElementById('femoralJustification')
                    .required = false;
                xrayCheck.style.display = 'block';
                document.querySelectorAll('input[name="xrayCheck"]')
                    .forEach(radio => radio.required = true);
            }
        });
    });

// Mostra/esconde graus de complicações conforme seleção
document.querySelector('input[name="bleeding"][value="sim"]')
    .addEventListener('change', function () {
        document.getElementById('grauSangramentoDiv')
            .style.display = 'block';
        document.getElementsByName('grauSangramento')
            .forEach(radio => radio.required = true);
    });

document.querySelector('input[name="bleeding"][value="nao"]')
    .addEventListener('change', function () {
        document.getElementById('grauSangramentoDiv')
            .style.display = 'none';
        document.getElementsByName('grauSangramento')
            .forEach(radio => radio.required = false);
    });

document.querySelector('input[name="arrhythmia"][value="sim"]')
    .addEventListener('change', function () {
        document.getElementById('grauArritmiaDiv')
            .style.display = 'block';
        document.getElementsByName('grauArritmia')
            .forEach(radio => radio.required = true);
    });

document.querySelector('input[name="arrhythmia"][value="nao"]')
    .addEventListener('change', function () {
        document.getElementById('grauArritmiaDiv')
            .style.display = 'none';
        document.getElementsByName('grauArritmia')
            .forEach(radio => radio.required = false);
    });

// Função para validar a justificativa do acesso femoral
function validateFemoralJustification(justification) {
    // Verifica comprimento mínimo (30 caracteres)
    if(justification.length < 30) {
        return {
            isValid: false,
            message: "A justificativa deve conter uma explicação mínima da indicação."
        };
    }
    
    // Lista de aspectos - pelo menos UM desses grupos deve estar presente
    const requiredAspects = [
        {
            keywords: ['trombo', 'us', 'ultrassom', 'eco', 'cervical', 'jugular', 'subclávia', 'anatomia'],
            description: 'condição anatômica/exame de imagem'
                },
        {
            keywords: ['urgência', 'emergência', 'emergencial', 'risco', 'grave', 'instável', 'crítico'],
            description: 'contexto de urgência'
                },
        {
            keywords: ['plano', 'programa', 'previsão', 'mudar', 'mudança', 'troca', 'trocar', 'nova', 'novo', 'semana'],
            description: 'plano de troca'
                }
            ];
    
    // Verifica presença de pelo menos um aspecto importante
    const presentAspects = requiredAspects.filter(aspect =>
        aspect.keywords.some(keyword =>
            justification.toLowerCase()
            .includes(keyword.toLowerCase())
        )
    );
    
    if(presentAspects.length < 2) {
        return {
            isValid: false,
            message: `A justificativa deve incluir pelo menos dois dos seguintes aspectos:\n- Condição anatômica ou exame de imagem\n- Contexto de urgência\n- Plano de troca`
        };
    }
    
    return {
        isValid: true,
        message: "Justificativa adequada."
    };
}

// Validação do formulário
document.getElementById('cvcForm')
    .addEventListener('submit', function (e) {
        e.preventDefault();
        
        const punctureSite = document.querySelector('input[name="punctureSite"]:checked')
            .value;
        
        if(punctureSite === 'femoral') {
            const justification = document.getElementById('femoralJustification')
                .value.trim();
            const validationResult = validateFemoralJustification(justification);
            
            if(!validationResult.isValid) {
                alert(validationResult.message);
                return;
            }
        } else {
            const xrayChecked = document.querySelector('input[name="xrayCheck"]:checked');
            if(!xrayChecked) {
                alert('Por favor, indique se foi solicitada radiografia de tórax após o procedimento.');
                return;
            }
        }
        
        // Coleta os dados do formulário
        const formData = {
            cateter: {
                tipo: document.getElementById('catheterType')
                    .value,
                numLumens: document.getElementById('lumensNumber')
                    .value
            },
            procedimento: {
                inicio: document.getElementById('startTime')
                    .value,
                termino: document.getElementById('endTime')
                    .value
            },
            sitio: {
                local: document.querySelector('input[name="punctureSite"]:checked')
                    .value,
                lateralidade: document.querySelector('input[name="laterality"]:checked')
                    .value
            },
            condicao: document.querySelector('input[name="condition"]:checked')
                .value,
            ultrassom: document.querySelector('input[name="ultrasound"]:checked')
                .value,
            tentativasPuncao: document.getElementById('attempts')
                .value,
            sucesso: document.querySelector('input[name="success"]:checked')
                .value,
            complicacoes: {
                puncaoArterial: document.querySelector('input[name="puncture"]:checked')
                    .value,
                pneumotorax: document.querySelector('input[name="pneumothorax"]:checked')
                    .value,
                hemotorax: document.querySelector('input[name="hemothorax"]:checked')
                    .value,
                sangramento: document.querySelector('input[name="bleeding"]:checked')
                    .value,
                arritmia: document.querySelector('input[name="arrhythmia"]:checked')
                    .value
            }
        };
        
        // Adiciona campos condicionais
        if(formData.sitio.local === 'femoral') {
            formData.justificativaFemoral = document.getElementById('femoralJustification')
                .value;
        } else {
            formData.raioX = document.querySelector('input[name="xrayCheck"]:checked')
                ?.value;
        }
        
        // Adiciona graus de complicações se aplicável
        if(formData.complicacoes.sangramento === 'sim') {
            formData.complicacoes.grauSangramento = document.querySelector('input[name="grauSangramento"]:checked')
                ?.value;
        }
        
        if(formData.complicacoes.arritmia === 'sim') {
            formData.complicacoes.grauArritmia = document.querySelector('input[name="grauArritmia"]:checked')
                ?.value;
        }
        
        // Exibe o JSON no console
        console.log('Dados do formulário:');
        alert(JSON.stringify(formData, null, 2));
    });

// Adiciona validação em tempo real para a justificativa
document.getElementById('femoralJustification')
    .addEventListener('input', function () {
        const justification = this.value.trim();
        const validationResult = validateFemoralJustification(justification);
        
        // Atualiza feedback visual
        this.style.borderColor = validationResult.isValid ? '#28a745' : '#dc3545';
        
        // Se quiser mostrar a mensagem em tempo real, pode adicionar um elemento para isso
        const feedbackDiv = document.getElementById('justificationFeedback') ||
            (() => {
                const div = document.createElement('div');
                div.id = 'justificationFeedback';
                div.style.fontSize = '0.875em';
                div.style.marginTop = '5px';
                this.parentNode.appendChild(div);
                return div;
            })();
        
        feedbackDiv.style.color = validationResult.isValid ? '#28a745' : '#dc3545';
        feedbackDiv.textContent = validationResult.message;
    });
</script>
